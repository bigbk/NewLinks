<!DOCTYPE html>
<html>

<head>
<title>VIN Decoder API Test</title>

<style type="text/css">
input {width: 200px;}
</style>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script type="text/javascript">
</script>

</head>

<body>
  <table align="center">
    <tr>
      <td align="center">
        <input type="text" id="b12" placeholder="VIN - 17 Digits" name="name" maxlength="100">
 
      <div>
        <output name="output" id="output">
          
        </output>
      </div>

      </td>
    </tr>
    <tr>
      <td align="center">
        <button id="btn_submit">Submit</button>
        
      </td>
    </tr>
    <tr>
      <td>
        <textarea id="txt_results" rows="15" cols="100" placeholder="Vehicle Data Presented Here"></textarea>
      </td>
    </tr>
  </table>


<script>
document.getElementById("btn_submit").onclick = function () {
  var vin;
  vin = document.getElementById("b12").value;
  if (vin.length === 17) {
    getNHTSADataByVIN(vin);
  } else {
       alert("VIN number should be 17 digits long, currently " + vin.length + " digits entered.");
}

};


function getNHTSADataByVIN (param_vin) {
  $.ajax({
    url: "https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVINValuesBatch/",
    //url: "https://obw.carmax.com/api/v1/blackbook/BlackBookVinValues/",
    type: "POST",
    data: { format: "json", data: param_vin },
    dataType: "json",
    success: function(result)
    {
      console.log(result);

  //alert("Make: " + result.Results[0].Make);

	if ( result.Results[0].ModelYear !== "")  { 
		aYear = result.Results[0].ModelYear
	} else {
		aYear = ""
	};
	if ( result.Results[0].Make !== "")  { 
		aMake = " " + result.Results[0].Make 
	} else {
		aMake = ""
	};
	if ( result.Results[0].Model !== "")  { 
		aModel = " " + result.Results[0].Model 
	} else {
		aModel = ""
	};
	if ( result.Results[0].Trim!== "")  { 
		aTrim = " " + result.Results[0].Trim
	} else {
		aTrim = ""
	};
	if ( result.Results[0].DisplacementL !== "")  { 
		aDisp = ", " + result.Results[0].DisplacementL + "L"
	} else {
		aDisp = ""
	};
	if ( result.Results[0].EngineCylinders !== "")  { 
		aCyl = ", " + result.Results[0].EngineCylinders + "cyl"
	} else {
		aCyl = ""
	};
	if ( result.Results[0].DriveType !== "")  { 
		aDrive = ", " + result.Results[0].DriveType
	} else {
		aDrive= ""
	};
	if ( result.Results[0].Doors !== "")  { 
		aDoor = ", " + result.Results[0].Doors + "D"
	} else {
		aDoor= ""
	};
	if ( result.Results[0].BodyCabType !== "")  { 
		aCab = ", " + result.Results[0].BodyCabType
	} else {
		aCab = ""
	};
	if ( result.Results[0].BodyClass !== "")  { 
		aBody = ", " + result.Results[0].BodyClass
	} else {
		aBody= ""
	};

 	
	document.getElementById("output").innerText = aYear + aMake + aModel + aTrim + aDisp + aCyl + aDrive  + " \n " + aDoor + aCab + aBody + " \r\n ";;
	//document.getElementById("output").value += aDoor + aCab + aBody + " \r\n ";

      displayNHTSAResults(result);
    },
    error: function(xhr, ajaxOptions, thrownError)
    {
        console.log(xhr.status);
        console.log(thrownError);
    }
  });
};
function displayNHTSAResults (param_data) {
  var output_text = "";
  for (var i = 0; i < param_data.Results.length; i++) {
    var result = param_data.Results[i];
    for (var prop in result) {
      if (result.hasOwnProperty(prop) && result[prop] !== "") {
        output_text += prop + ": " + result[prop] + "\n";
      }
    }
  }
  document.getElementById("txt_results").value = output_text;
};
</script>
                                                
</body>
</html>
